---
show: step
version: 1.0
enable_checker: true
---

# 范围控制
## 回忆
- 上次了解到块可视模式
	-<kbd>ctrl</kbd>+<kbd>v</kbd>
	- 左下角`-- 可视 块 --`
	- 然后配合`motion`
	- <kbd>o</kbd>切换首尾
	- 这个块可以有四个顶点
	- <kbd>O</kbd>横向切换
- 可以在选区内进行编辑和替换
	- 可以直接<kbd>d</kbd>、<kbd>c</kbd>、<kbd>y</kbd>
	- 或者<kbd>D</kbd>、<kbd>C</kbd>、<kbd>Y</kbd>
	- 也可以直接编辑
		- `:'<,'>d`
		- `:'<,'>s/shiyanlou/oeasy/g` 范围内批量替换
- 可以在块·可视化模式下替换
	- `:'<,'>s/\%Vg/graphic/g`
	- '<,'>表示范围
	- s表示substitute
	- \%V表示在块内
- 文本编辑终于告一段落
- 这个可视化块儿模式不来自于vi
- 而是来自于他的克隆vim
- vim是如何诞生的呢？🤔

### 前情回顾
- `vi` 是除 `ed` 之外唯一与 `BSD Unix` 捆绑的文本编辑器
	- `Emacs` 可能会花费数百美元
	- 这是在 `GNU Emacs` 之前
	- 所以 `vi` 变得非常流行
- 但 `vi` 是 `ed` 的直接衍生版本
	- 这意味着如果没有` AT&T` 的源代码
	- 源代码就不能被修改
- 这促使一些人创建了 `vi` 的开源版本
	- `STEVIE` （专门为 `VI` 爱好者的 `ST` 编辑器）出现于1987年
	- `Elvis` 出现于 1990 年
	- `nvi` 出现于 1994 年
	- 微软dos上也有了类似的东西
		- 行编辑器edlin
		- 全屏编辑器edit
	- 其中一些克隆版本添加了额外的功能
	- 如语法高亮和窗口分离
- 众多克隆中比较出色的是`Elvis`
	- 它的许多功能被整合到 `Vim` 中
	- 因为许多 `Elvis` 用户推动了这些功能的加入
- GUI变得开始流行
	- 但是也有人给 `Elvis` 加了一个图形用户界面
	- 然后就当商业软件来卖
	- 这些人没有写`Elvis`却挣了很多钱
	- 而`Elvis`无法得到相应的资源和回馈

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220430-1651323677538)

- 2003年后Elvis 2.2这个版本到此为止
- 没有继续更新

### vim缘起

- 在荷兰 1985年
	- Delft大学

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220430-1651304791195)

- Bram Moolenaar 出生在荷兰
	- 就在郁金香盛开的地方
	- 在大学学习电子工程
	- 电烙铁非常熟练

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220430-1651305165615)

- 当时计算机相比电子工程
	- 还是非常小众的边缘科学
	- 软件更是小众
- 当时有一个实践课
	- 课上只有一个电脑
	- 电脑上的编辑器是vi
	- 他觉得vi很难用
	- 跟老师去抱怨
	- 老师解决办法是
		- 给了他一页纸cheat code操作说明
- 就这样他开始被迫学习vi
	- 毕业设计选是unix操作系统上的多进程架构


### 毕业
![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220430-1651319231837) 

- 毕业后去了`Venlo` ，在城市东部

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220430-1651305135366)
 


### Venlo

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220430-1651305482694)

- 毕业后`Bram Moolenaar`去了Oce
	- 一家影印公司工作做工程师 
- 想要为他全新的 `Amiga 2000` 准备一款类似于 `vi` 的编辑器
	- `Moolenaar` 已经习惯了在大学时使用的 `Unix` 系统上的 `vi` 
	- 当时他 已经对 `vi` 了如指掌
	- 所以在 1988 年
	- 他找遍了所有可以用的vi克隆



### 找到vi

- 后来`Moolenaar` 偶然接触到接触到 `STEVIE` 
	- 缘于其曾经出现在一个叫 `Fred Fish` 的磁盘上
	- `Fred Fish` 是一名美国程序员
	- 每个月都会寄出一张软盘
	- 内含为 `Amiga` 平台提供的精选可用开源软件

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210202-1612232002004)
（Bram Moolenaar，2006 年加入 Google）

- 有点类似于国内曾经的软件指南
	- 任何人只要支付邮费就可以得到一张这样的磁盘
	- 有若干版本的 `STEVIE` 曾在 `Fred Fish` 磁盘上发布
	- `Moolenaar` 使用的 `STEVIE` 版本在 `Fred Fish 256` 号磁盘上发布


### Mooleanaar

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220430-1651305552458)

- 他的姓氏来自于驾驶风车的人
	- 风车(风力驱动的磨坊)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220429-1651234254434)

- `Moolenaar` 喜欢 `STEVIE`
	- 但很快就注意到其缺失了很多 `vi` 命令
	- 因此，在第一次发布 `Vim` 时
	- `Moolenaar` 优先考虑了 `vi` 的兼容性
- 当时已经有其他人编写了一系列的 `vi` patches(补丁)
	- 当运行一个合适的 `vi` 兼容编辑器时
	- 可以求解随机生成的迷宫
	- `Moolenaar` 能够让这些宏在 `Vim` 中运行
	- `Elvis` 此时也和 `vim` 互相借鉴
- 1991年
	- `Vim` 以 `Vi模仿者(Vi IMitation)` 为名第一次发布于 `Fred Fish 591` 号磁盘
	- `Moolenaar` 添加了一些特性（包括多级撤销和解决编译器错误的“`quickfix`”模式）
	- 这意味着 `Vim` 已经完成了对 `Vi` 的重构
- 在 1993 年
	- 通过 FTP 发布 `Vim 2.0` 之前
	- `Vim` 都仍以 `Vi模仿者` 的身份存在


- 和其他许多`“vi克隆版本”`一样
	- `Vim` 始于在一个无法使用 `vi` 的平台上复现 `vi` 的一个尝试

### 从vi到vim 

- 在众多互联网合作者的帮助下
	- Moolenaar` 稳健地在 `Vim` 中加入了一些功能
	- `Vim 2.0` 引入了对 `wrap` 选项的支持
	- 以及对长行文本进行水平滚动的支持
- 受到了 `vi克隆nvi` 的启发
	- `Vim 3.0` 增加了对分割窗口和缓冲区的支持
	- `Vim` 现在还将每个缓冲区保存到交换文件中以避免程序崩溃造成文件丢失
- `Vim 5.0` 中
	- `Vim` 支持语法高亮显示
	- Vim 的受欢迎程度也在不断增长
	- 一些人把他移植到 `MS-DOS`、 `Windows`、`Mac`
	- 甚至被移植到 `Unix` 与原来的 `vi` 竞争
- `Vim`的含义也变成了`Vi IMproved`(Vi 改进版)
	- 最初代表的是` 模拟版 Vi`
- 有了更多的人用
	- 也有了更多的反馈 

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220430-1651305683020)

### 反馈

- 1998年11月
	- 进行了一项调查
	- 允许Vim用户投票支持对Vim的更改
	- 这样就可以很好地了解用户想要添加的内容
	- 以下是前六名：
		1. 添加折叠（仅显示文本的选定部分）
		2. 垂直分体式窗户（并排）
		3. 为多种语言（如“cindent”）添加可配置的自动缩进
		4. 解决所有问题，无论大小；让Vim更健壮
		5. 添加与Perl兼容的搜索模式
		6. 搜索跨越边界的模式


- 前三项和第六项已在Vim 6.0中实现
- 搜索模式已经扩展到包括所有Perl特性
- 并不直接与Perl兼容
- 这将导致向后兼容性问题
- 可以看到vim已经发展起来了
- 那么vim算是开源软件么？
- 使用什么样的协议呢？

### 协议

- 并不是GNU 通用公共许可证 (GPL)
	- 因为gpl限制性更强
	- 尽管它声称确定了软件的自由
	- 但限制了您可以进行的更改
- 也就是说
	- 可以进行更改
	- 但分发修改后的软件时
	- 您必须使修改后的源也可用
	- 因此，人们不能自由地将这些变化的代码只留给自己
- Elvis的遭遇使得bram在思考使用什么版权
- 是否是完全开源呢？
	- Bram不同意所有软件都应该是免费和开源的想法
		- Bram认识的所有从事自由软件工作的人都以某种方式以商业软件为生
			- 要么是全职工作
			- 要么是通过学习以后找到工作
		- 如果没有商业软件，这些人将如何谋生？
		- 过于激进是不行的
- 是否闭源呢？
	- 最早Elvis和类似的东西是开源的
	- 而且linux的成功也证明大体量长周期的系统性开发是可以开源的
	- Bram总结了一个项目开源人数的公式
	- available = interested x ability x motivation
		- available可以开发的人
		- interested 有兴趣的
			- 取决于现有软件是否又贵又不好
			- 这里软件是否是人人都要用
		- ability 有能力的 
			- 取决于这个软件的目标对象
			- 如果目标是软件工程师用的软件
			- 那个系数会大幅增高
		- motivation 愿意开发的 
			- 这是本公式最大的变数
			- 起心动念最难参透
- 这公式都整出来了
	- 到底是开源还是闭源？

### 共存
- Bram认为免费的开源软件和商业软件将共存
	- 大多数商业软件不能是开源的
		- 因为公司将失去对竞争对手的优势
		- 创建源代码非常昂贵
		- 公司不希望让其他人免费获得结果
		- 由于软件专利和版权是一种非常薄弱的保护在大多数情况下
		- 对源代码保密仍然是最佳选择
		- 不幸的是，这意味着您无法学习商业软件的实施方式
		- 也无法在您购买的程序中添加功能或修复错误
		- 一个解决方案可以是使大部分程序开源
		- 并将一小部分但必不可少的部分保密
- Bram决定所有Vim更改都必须告知Bram
	- Bram可以确定这些更改对大多数人有用
		- 并将它们包含在 Vim 中
	- 或者决定这些变化只有很小的受众
		- 并允许公司从他们的工作中赚一点钱
- 这都是前辈经验之谈和肺腑之言

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220430-1651283953496)

### 发展 

- 在 1980 年代末和整个 1990 年代
	- 程序员一度发起了“编辑器战争”
	- 将 `Emacs` 用户与 `vi` （即最终的 `Vim` ）用户进行了对比
	- 虽然 `Emacs` 肯定仍有一些追随者


![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220430-1651330129429)

- 2006 年
	- `Vim` 被 `Linux Journal` 读者评为最受欢迎的编辑器
	- 根据 2018 年 `Stack Overflow` 的开发者调查
		- `Vim` 是最受欢迎的文本模式（即终端模拟器）编辑器
		- 受用于 25.8% 的软件开发人员(和 40% 的 Sysadmin / DevOps 人员)
		- 只有 4.1% 的受访者使用 Emacs

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220430-1651318516629)

### 整体回顾

 | 年月 | 版本 | 事件 |
 | -- | -- | -- | 
 |1991 Nov 2  | Vim 1.14|First release (on Fred Fish disk #591)|
 |1992        | Vim 1.22|Port to Unix.  Vim now competes with Vi|
 |1994 Aug 12 | Vim 3.0|  Support for multiple buffers and windows|
 |1996 May 29 | Vim 4.0|  Graphical User Interface (largely by Robert Webb)|
 |1998| Feb 19 | Vim 5.0|Syntax coloring/highlighting|
 |2001 Sep 26 | Vim 6.0|folding, plugins, vertical split|


- `Vim` 是如何变得如此成功的？
	- 显然，人们喜欢 `Vim` 所提供的特性
	- 但我认为，`Vim` 背后的悠久历史表明了它的优势远不仅仅体现在其功能集上
	- `Vim` 的代码库可以追溯到 1988 年
	- 当时 `Moolenaar` 开始研究它

- 某种程度上要感谢 `Bill Joy` 和 `Bram Moolenaar` 对向后兼容性非比寻常的关注
	- 才使好的想法逐渐积累起来
	- 从这个意义上说
	- `vim文本编辑器` 是运行时间最长、最成功的开源项目之一
	- 跨越项目的项目
	- 得益于计算机世界中一些最伟大的思想贡献
	- 创业公司无视所有先例来创造颠覆性的新软件固然很厉害
	- 但 `Vim` 提醒我们
	- 这种协作和增量的方式同样能产生奇迹
- 向前辈致以敬意！

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220430-1651317811783)

### 总结

- vim表面上是一个软件
	- 其实他也有深厚的历史
	- 跨越了时代、项目和版本
	- 在年代的穿透中有一种源远流长的感觉
	- 新芽必发于陈
- 让我想到一句老话
	- 孰能浊以止，静之徐清？
	- 孰能安以久，动之徐生？
	- 保此道者不欲盈
	- 夫唯不盈
		- 故能敝而新成
- 总结一下前几节学习的可视化模式吧？🤔
- 下次再说！👋🏻